<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ride Partner - Direct IPv4 Access</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
      color: #333;
      line-height: 1.6;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    header {
      background-color: #3a7bd5;
      color: white;
      padding: 20px;
      text-align: center;
    }
    h1 {
      margin: 0;
      font-size: 24px;
    }
    .box {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    .status {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    .status-icon {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      margin-right: 10px;
    }
    .status-good {
      background-color: #4CAF50;
    }
    .status-bad {
      background-color: #F44336;
    }
    .status-warning {
      background-color: #FF9800;
    }
    button, .button {
      background-color: #3a7bd5;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      display: inline-block;
      text-decoration: none;
      margin: 5px 0;
    }
    button:hover, .button:hover {
      background-color: #2c5ea3;
    }
    input {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }
    .copy-area {
      display: flex;
      margin-bottom: 15px;
    }
    .copy-area input {
      margin-bottom: 0;
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }
    .copy-area button {
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
      margin: 0;
    }
    .access-options {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    .access-option {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 15px;
      text-align: center;
    }
    .access-option h3 {
      margin-top: 0;
      color: #3a7bd5;
    }
    #server-url {
      font-weight: bold;
      word-break: break-all;
    }
    .connection-status {
      margin-top: 5px;
      font-weight: bold;
    }
    .ip-address {
      font-family: monospace;
      background: #eaeaea;
      padding: 8px;
      border-radius: 4px;
      margin: 5px 0;
      display: inline-block;
    }
  </style>
</head>
<body>
  <header>
    <h1>Ride Partner - Direct IPv4 Access</h1>
  </header>

  <div class="container">
    <div class="box">
      <h2>Server Connection Status</h2>
      <div class="status">
        <div id="connection-status-icon" class="status-icon status-warning"></div>
        <div id="connection-status">Checking connection...</div>
      </div>
      <p>Server time: <span id="server-time">Checking...</span></p>
      <p>Current IPv4 address: <span id="ip-address" class="ip-address">Checking...</span></p>
      <p>Connection type: <span id="connection-type">Checking...</span></p>
    </div>

    <div class="box">
      <h2>Direct Access Links</h2>
      <p>Use these links to bypass DNS resolution problems:</p>
      
      <h3>Mobile Optimized</h3>
      <div class="copy-area">
        <input type="text" id="mobile-link" readonly>
        <button onclick="copyText('mobile-link')">Copy</button>
      </div>
      
      <h3>Super Light Version</h3>
      <div class="copy-area">
        <input type="text" id="super-light-link" readonly>
        <button onclick="copyText('super-light-link')">Copy</button>
      </div>
      
      <h3>Full Application</h3>
      <div class="copy-area">
        <input type="text" id="full-app-link" readonly>
        <button onclick="copyText('full-app-link')">Copy</button>
      </div>
      
      <p>Bookmark these links for future use. They will work even when normal domain access fails.</p>
    </div>

    <div class="access-options">
      <div class="access-option">
        <h3>Mobile Version</h3>
        <p>Optimized for mobile devices.</p>
        <a href="#" id="mobile-button" class="button">Open Mobile</a>
      </div>
      
      <div class="access-option">
        <h3>Super Light</h3>
        <p>For very poor connections.</p>
        <a href="#" id="super-light-button" class="button">Open Super Light</a>
      </div>
      
      <div class="access-option">
        <h3>Full App</h3>
        <p>Complete application.</p>
        <a href="#" id="full-app-button" class="button">Open Full App</a>
      </div>
    </div>
  </div>

  <script>
    // Function to copy text from input field
    function copyText(elementId) {
      const copyText = document.getElementById(elementId);
      copyText.select();
      copyText.setSelectionRange(0, 99999);
      navigator.clipboard.writeText(copyText.value)
        .then(() => {
          alert("Copied the link: " + copyText.value);
        })
        .catch(err => {
          console.error('Could not copy text: ', err);
          alert("Please copy manually: " + copyText.value);
        });
    }

    // Check the server connection and update UI
    async function checkConnection() {
      try {
        const response = await fetch('/api/connection-info');
        const data = await response.json();
        
        // Update connection status
        document.getElementById('connection-status-icon').className = 'status-icon status-good';
        document.getElementById('connection-status').textContent = 'Connected to server';
        
        // Update server time
        document.getElementById('server-time').textContent = new Date(data.serverTime).toLocaleString();
        
        // Get IP address
        const host = window.location.hostname;
        document.getElementById('ip-address').textContent = host;
        
        // Connection type
        const connectionType = data.connection.encrypted ? 'HTTPS (Encrypted)' : 'HTTP (Unencrypted)';
        document.getElementById('connection-type').textContent = connectionType;
        
        // Set up direct links
        const port = data.serverPort || window.location.port || '5000';
        const protocol = window.location.protocol;
        
        const mobileLinkElement = document.getElementById('mobile-link');
        const superLightLinkElement = document.getElementById('super-light-link');
        const fullAppLinkElement = document.getElementById('full-app-link');
        
        const mobileLink = `${protocol}//${host}:${port}/mobile`;
        const superLightLink = `${protocol}//${host}:${port}/super-light`;
        const fullAppLink = `${protocol}//${host}:${port}/`;
        
        mobileLinkElement.value = mobileLink;
        superLightLinkElement.value = superLightLink;
        fullAppLinkElement.value = fullAppLink;
        
        // Set up buttons
        document.getElementById('mobile-button').href = mobileLink;
        document.getElementById('super-light-button').href = superLightLink;
        document.getElementById('full-app-button').href = fullAppLink;
        
      } catch (error) {
        console.error('Connection error:', error);
        document.getElementById('connection-status-icon').className = 'status-icon status-bad';
        document.getElementById('connection-status').textContent = 'Connection error: ' + error.message;
      }
    }

    // Run the connection check when the page loads
    window.addEventListener('load', checkConnection);
  </script>
</body>
</html>