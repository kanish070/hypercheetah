<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ride Partner Mobile Access</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f7fa;
      color: #333;
    }
    
    .header {
      background: linear-gradient(135deg, #3a7bd5, #00d2ff);
      color: white;
      padding: 20px;
      text-align: center;
    }
    
    h1 {
      margin: 0;
      font-size: 1.8rem;
    }
    
    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .button {
      display: block;
      background: #3a7bd5;
      color: white;
      text-decoration: none;
      padding: 15px;
      border-radius: 8px;
      font-weight: bold;
      margin: 15px 0;
      text-align: center;
      font-size: 1.1rem;
    }
    
    .button.secondary {
      background: #edf2f7;
      color: #3a7bd5;
      border: 1px solid #3a7bd5;
    }
    
    .ip-box {
      background: #edf2f7;
      padding: 15px;
      border-radius: 8px;
      font-family: monospace;
      margin: 15px 0;
      word-break: break-all;
    }
    
    .note {
      background: #ffe8cc;
      border-left: 4px solid #ff9500;
      padding: 10px 15px;
      margin: 20px 0;
      border-radius: 0 8px 8px 0;
    }
    
    .success {
      background: #d4edda;
      border-left: 4px solid #28a745;
      padding: 10px 15px;
      margin: 20px 0;
      border-radius: 0 8px 8px 0;
    }
    
    #connection-status {
      text-align: center;
      margin: 20px 0;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Ride Partner</h1>
    <p>Direct Mobile Access</p>
  </div>
  
  <div class="container">
    <div id="connection-status">Checking connection...</div>
    
    <div class="card">
      <h2>Access Options</h2>
      
      <div class="note">
        <p><strong>Having trouble connecting?</strong> Use one of these direct options to bypass DNS resolution issues.</p>
      </div>
      
      <h3>Option 1: Use Raw IP Address</h3>
      <div class="ip-box" id="direct-ip-link">
        Loading direct IP link...
      </div>
      <a href="#" class="button" id="copy-ip-button">Copy IP Link</a>
      
      <h3>Option 2: Access Simplified Version</h3>
      <p>Try our lightweight version that works even on slow connections:</p>
      <a href="/lite" class="button">Open Lite Version</a>
      
      <h3>Option 3: Try Full App</h3>
      <a href="/" class="button secondary">Access Full App</a>
    </div>
    
    <div class="card">
      <h2>Connection Troubleshooting</h2>
      <ul>
        <li>Make sure you're connected to the internet</li>
        <li>Try connecting to the same WiFi network as the server</li>
        <li>Clear your browser cache and cookies</li>
        <li>Try a different browser if available</li>
      </ul>
    </div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', async function() {
      const connectionStatus = document.getElementById('connection-status');
      const directIpLink = document.getElementById('direct-ip-link');
      const copyIpButton = document.getElementById('copy-ip-button');
      
      try {
        // Test the connection
        const startTime = Date.now();
        const response = await fetch('/api/health');
        const endTime = Date.now();
        const pingTime = endTime - startTime;
        
        if (response.ok) {
          const data = await response.json();
          connectionStatus.textContent = `Connected! (${pingTime}ms)`;
          connectionStatus.className = 'success';
          
          // Get connection info for direct IP link
          const connResponse = await fetch('/api/connection-info');
          const connData = await connResponse.json();
          
          const protocol = window.location.protocol;
          const host = window.location.hostname;
          const port = connData.serverPort || window.location.port || "5000";
          
          const directUrl = `${protocol}//${host}:${port}/direct-ip`;
          directIpLink.textContent = directUrl;
          
          // Set up copy button
          copyIpButton.addEventListener('click', function(e) {
            e.preventDefault();
            navigator.clipboard.writeText(directUrl)
              .then(() => {
                alert('Direct IP link copied to clipboard!');
              })
              .catch(err => {
                console.error('Could not copy text: ', err);
                // Fallback for mobile
                const tempInput = document.createElement('input');
                tempInput.value = directUrl;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);
                alert('Direct IP link copied to clipboard!');
              });
          });
        } else {
          throw new Error(`Server responded with status ${response.status}`);
        }
      } catch (error) {
        console.error('Connection error:', error);
        connectionStatus.textContent = 'Connection error. Trying alternative method...';
        connectionStatus.style.color = '#dc3545';
        
        // Fallback to hardcoded IP link
        const protocol = window.location.protocol;
        const host = window.location.hostname || "0.0.0.0";
        const port = "5000";
        
        const directUrl = `${protocol}//${host}:${port}/direct-ip`;
        directIpLink.textContent = directUrl;
        
        copyIpButton.addEventListener('click', function(e) {
          e.preventDefault();
          const tempInput = document.createElement('input');
          tempInput.value = directUrl;
          document.body.appendChild(tempInput);
          tempInput.select();
          document.execCommand('copy');
          document.body.removeChild(tempInput);
          alert('Direct IP link copied to clipboard!');
        });
      }
    });
  </script>
</body>
</html>