<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Ride Partner - Mobile Direct Access</title>
  <style>
    :root {
      --primary: #3a7bd5;
      --primary-dark: #2a5db5;
      --accent: #00d2ff;
      --danger: #e91e63;
      --warning: #ff9800;
      --success: #4caf50;
      --text: #333;
      --white: #fff;
      --black: #000;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --radius: 12px;
      --font: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: var(--font);
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color: var(--white);
      min-height: 100vh;
      padding: 15px;
      line-height: 1.6;
    }
    
    .container {
      max-width: 500px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
    }
    
    h1 {
      font-size: 1.8rem;
      margin-bottom: 1rem;
      text-align: center;
    }
    
    h2 {
      font-size: 1.4rem;
      margin-bottom: 0.8rem;
    }
    
    p {
      margin-bottom: 1rem;
      font-size: 0.95rem;
    }
    
    .btn {
      display: block;
      background: var(--white);
      color: var(--primary);
      font-weight: bold;
      padding: 12px;
      border-radius: 50px;
      text-decoration: none;
      text-align: center;
      margin: 15px auto;
      transition: transform 0.3s;
      font-size: 1rem;
      width: 100%;
      max-width: 300px;
    }
    
    .btn:hover {
      transform: translateY(-3px);
    }
    
    .btn-large {
      padding: 15px;
      font-size: 1.1rem;
    }
    
    .btn-primary {
      background: var(--primary-dark);
      color: var(--white);
    }
    
    .btn-danger {
      background: var(--danger);
      color: var(--white);
    }
    
    .btn-warning {
      background: var(--warning);
      color: var(--black);
    }
    
    .info-box {
      background: rgba(0, 0, 0, 0.1);
      border-radius: var(--radius);
      padding: 15px;
      margin: 15px 0;
    }
    
    .info-box h3 {
      margin-bottom: 8px;
      font-size: 1.1rem;
    }
    
    .qr-container {
      text-align: center;
      margin: 20px 0;
    }
    
    #qrcode {
      background: white;
      padding: 15px;
      display: inline-block;
      border-radius: 10px;
    }
    
    .access-list {
      margin: 15px 0;
    }
    
    .access-item {
      background: rgba(255, 255, 255, 0.1);
      padding: 10px 15px;
      border-radius: 10px;
      margin-bottom: 10px;
      word-break: break-all;
      font-family: monospace;
      font-size: 0.9rem;
    }
    
    .access-item strong {
      display: block;
      margin-bottom: 5px;
    }
    
    #status {
      padding: 10px;
      border-radius: var(--radius);
      margin: 15px 0;
      text-align: center;
    }
    
    .status-checking {
      background: rgba(255, 255, 255, 0.1);
    }
    
    .status-ok {
      background: rgba(76, 175, 80, 0.2);
    }
    
    .status-error {
      background: rgba(233, 30, 99, 0.2);
    }
    
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
      margin-right: 8px;
      vertical-align: middle;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Mobile Direct Access</h1>
    
    <div class="info-box">
      <h3>⚠️ DNS Issues Detected</h3>
      <p>This page provides several direct access methods when DNS resolution issues prevent normal access to Ride Partner.</p>
    </div>
    
    <div id="status" class="status-checking">
      <div class="loading-spinner"></div>
      Checking connection...
    </div>
    
    <h2>Direct Access Methods</h2>
    <p>Try one of these access options to bypass DNS issues:</p>
    
    <a href="#" class="btn btn-large btn-primary" id="direct-url-btn">Direct Access URL</a>
    <a href="#" class="btn btn-warning" id="ip-url-btn">Raw IP Address</a>
    <a href="#" class="btn" id="local-url-btn">Local Network Access</a>
    
    <div class="info-box">
      <h3>Scan QR Code</h3>
      <p>Use another device to scan this QR code for direct access:</p>
      <div class="qr-container">
        <div id="qrcode"></div>
        <p id="qr-url" style="margin-top: 10px;"></p>
      </div>
    </div>
    
    <h2>All Access URLs</h2>
    <div class="access-list" id="access-list">
      <div class="access-item">Loading available connection methods...</div>
    </div>
    
    <a href="/" class="btn">Back to Home</a>
    <a href="/fallback" class="btn btn-danger">Emergency Access</a>
  </div>
  
  <!-- Include QRCode.js library -->
  <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
  
  <script>
    // Elements
    const statusElement = document.getElementById('status');
    const directUrlBtn = document.getElementById('direct-url-btn');
    const ipUrlBtn = document.getElementById('ip-url-btn');
    const localUrlBtn = document.getElementById('local-url-btn');
    const accessListElement = document.getElementById('access-list');
    const qrUrlElement = document.getElementById('qr-url');
    
    // Configuration
    const port = '5000'; // Our working port
    let directUrl = '';
    
    // Function to update status
    function updateStatus(message, type) {
      statusElement.textContent = message;
      statusElement.className = type;
    }
    
    // Function to add access URL to the list
    function addAccessUrl(label, url) {
      const item = document.createElement('div');
      item.className = 'access-item';
      item.innerHTML = `<strong>${label}:</strong> ${url}`;
      item.addEventListener('click', () => {
        window.location.href = url;
      });
      accessListElement.appendChild(item);
      return url;
    }
    
    // Test connection to server
    fetch('/api/health')
      .then(response => response.json())
      .then(data => {
        if (data.status === 'ok') {
          updateStatus('✅ Server is online and responding', 'status-ok');
        } else {
          updateStatus('⚠️ Server is online but reporting issues', 'status-warning');
        }
      })
      .catch(error => {
        console.error('Error checking server status:', error);
        updateStatus('❌ Unable to connect to server', 'status-error');
      });
    
    // Get connection information
    fetch('/api/connection-info')
      .then(response => response.json())
      .then(data => {
        // Clear access list
        accessListElement.innerHTML = '';
        
        // Get hostname from current URL
        const hostname = window.location.hostname;
        const serverIp = data.clientIp || '127.0.0.1';
        
        // Generate access URLs
        const domainUrl = `http://${hostname}:${port}`;
        const directIpUrl = `http://${hostname.replace('.replit.dev', '')}:${port}`;
        const localUrl = `http://localhost:${port}`;
        const rawIpUrl = `http://${serverIp}:${port}`;
        
        // Add URLs to the list and return preferred URL for QR code
        addAccessUrl('Domain URL', domainUrl);
        directUrl = addAccessUrl('Direct IP', directIpUrl);
        addAccessUrl('Local Access', localUrl);
        addAccessUrl('Server IP', rawIpUrl);
        
        // Update buttons
        directUrlBtn.href = directUrl;
        ipUrlBtn.href = rawIpUrl;
        localUrlBtn.href = localUrl;
        
        // Generate QR code for direct access
        generateQRCode(directUrl);
        qrUrlElement.textContent = directUrl;
      })
      .catch(error => {
        console.error('Error fetching connection info:', error);
        accessListElement.innerHTML = `
          <div class="access-item">
            <strong>Error:</strong> Failed to get connection information.
          </div>
          <div class="access-item">
            <strong>Default IP:</strong> http://0.0.0.0:${port}
          </div>
          <div class="access-item">
            <strong>Localhost:</strong> http://localhost:${port}
          </div>
        `;
        
        // Set fallback URLs
        directUrl = `http://0.0.0.0:${port}`;
        directUrlBtn.href = directUrl;
        ipUrlBtn.href = `http://127.0.0.1:${port}`;
        localUrlBtn.href = `http://localhost:${port}`;
        
        // Generate QR code for direct access using fallback
        generateQRCode(directUrl);
        qrUrlElement.textContent = directUrl;
      });
    
    // Generate QR code
    function generateQRCode(url) {
      // Clear existing QR code if any
      document.getElementById('qrcode').innerHTML = '';
      
      // Generate new QR code
      new QRCode(document.getElementById('qrcode'), {
        text: url,
        width: 180,
        height: 180,
        colorDark: '#000000',
        colorLight: '#ffffff',
        correctLevel: QRCode.CorrectLevel.H
      });
    }
  </script>
</body>
</html>